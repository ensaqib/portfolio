<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0b0e14">
  <title>Construction Innovation Platform 2026</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

<div class="app-layout">

  <!-- â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<aside class="sidebar">
  <div class="sidebar-brand">
    <a class="brand-logo" href="#" onclick="navigateTo('dashboard');return false;">
      <div id="brand-logo-wrap" style="width:60px;height:60px;overflow:hidden;border-radius:8px;background:transparent;">
        <img id="sidebar-logo" style="width:100%;height:100%;object-fit:contain" alt="CI">
      </div>
      <div class="brand-text">
        <div class="brand-name">CONSTRUCTION INNOVATION</div>
        <div class="brand-sub">Platform v2026 | Engr. Saqib Hussain (PE)</div>
      </div>
    </a>
  </div>

    <!-- Project Switcher -->
    <div class="project-switcher">
      <select id="project-switcher" title="Switch project"></select>
      <button class="btn btn-sm btn-primary" style="margin-top:6px;width:100%" onclick="openAddProjectModal()">â• New Project</button>
    </div>

    <!-- Project Progress -->
    <div class="sidebar-project">
      <div class="proj-label">Active Project</div>
      <div class="proj-name" id="project-name-display">Loadingâ€¦</div>
      <div class="proj-progress">
        <div class="progress-bar-mini"><div class="progress-fill-mini" id="sidebar-progress-fill" style="width:0%"></div></div>
        <span class="progress-pct" id="sidebar-progress-pct">0%</span>
      </div>
    </div>

    <!-- Nav -->
    <nav class="sidebar-nav">
      <div class="nav-section-label">Overview</div>
      <button class="nav-item active" data-page="dashboard"><span class="nav-icon">ğŸ“Š</span>Dashboard</button>
      <button class="nav-item" data-page="progress"><span class="nav-icon">ğŸ“ˆ</span>Progress Tracker</button>
      <button class="nav-item" data-page="projects"><span class="nav-icon">ğŸ“</span>Projects</button>

      <div class="nav-section-label">Document Control</div>
      <button class="nav-item" data-page="drawings"><span class="nav-icon">ğŸ“</span>Drawing Register<span class="nav-badge" id="nav-badge-drawings">3</span></button>
      <button class="nav-item" data-page="materials"><span class="nav-icon">ğŸ§±</span>Material Submittals</button>
      <button class="nav-item" data-page="methods"><span class="nav-icon">ğŸ“‹</span>Method Statements</button>
      <button class="nav-item" data-page="testing"><span class="nav-icon">ğŸ”¬</span>Test &amp; Commissioning</button>

      <div class="nav-section-label">Site Management</div>
      <button class="nav-item" data-page="ncr"><span class="nav-icon">âš ï¸</span>NCR / RFI / SI<span class="nav-badge">7</span></button>
      <button class="nav-item" data-page="hse"><span class="nav-icon">ğŸ¦º</span>HSE Register<span class="nav-badge">2</span></button>
      <button class="nav-item" data-page="manpower"><span class="nav-icon">ğŸ‘·</span>Manpower &amp; Equipment</button>

      <div class="nav-section-label">Commercial</div>
      <button class="nav-item" data-page="procurement"><span class="nav-icon">ğŸ›’</span>Procurement Tracker</button>
      <button class="nav-item" data-page="cost"><span class="nav-icon">ğŸ’°</span>Cost Control</button>
      <button class="nav-item" data-page="subcontractors"><span class="nav-icon">ğŸ¤</span>Subcontractors</button>

      <div class="nav-section-label">Closeout</div>
      <button class="nav-item" data-page="closeout"><span class="nav-icon">ğŸ</span>Project Closeout</button>
    </nav>

    <div class="sidebar-footer">
      <div class="user-card">
        <div class="user-avatar" id="sidebar-user-avatar">SH</div>
        <div class="user-info">
          <div class="user-name" id="sidebar-user-name">Engr. Saqib Hussain (PE)</div>
          <div class="user-role" id="sidebar-user-role">ADMIN</div>
        </div>
        <button class="btn btn-sm btn-secondary btn-icon" onclick="showToast('Settings','Settings coming soon','info')">âš™ï¸</button>
      </div>
    </div>
  </aside>

  <!-- â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <header class="app-header">
    <button class="header-btn mobile-menu-btn" id="mobile-menu-btn" style="display:none">â˜°</button>
    <div class="header-page-title" id="header-page-title">Dashboard Overview</div>
    <!-- TOP SEARCH BAR REMOVED per user request -->
    <div class="header-actions">
      <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--text-muted);padding:0 8px;border-right:1px solid var(--border)" id="project-ref">NXT-2026</div>
      <button class="header-btn" id="theme-toggle" data-tooltip="Toggle Theme">â˜€ï¸</button>
      <button class="header-btn" id="notif-btn" style="position:relative">ğŸ””<span class="notif-dot" id="notif-dot" style="display:none"></span></button>
      <span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--text-muted);background:rgba(59,130,246,0.1);padding:3px 7px;border-radius:4px;border:1px solid rgba(59,130,246,0.2)" id="notif-badge-count">3</span>
    </div>
  </header>

  <!-- â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <main class="app-main">

    <!-- â•â•â• DASHBOARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="page-section active" id="page-dashboard">
      <div class="welcome-banner">
        <div class="welcome-text">
          <div class="wt-greeting">ğŸ— CONSTRUCTION INNOVATION PLATFORM â€” LIVE DASHBOARD</div>
          <div class="wt-title" id="wb-project">Loadingâ€¦</div>
          <div class="wt-sub">Admin: Engr. Saqib Hussain (PE) â€” Lead Electrical Engineer</div>
        </div>
        <div class="welcome-stats">
          <div class="ws-item"><div class="ws-value" id="wb-progress" style="color:var(--accent-blue)">34%</div><div class="ws-label">Complete</div></div>
          <div class="ws-item"><div class="ws-value" id="wb-workers" style="color:var(--accent-emerald)">412</div><div class="ws-label">Workers</div></div>
          <div class="ws-item"><div class="ws-value" id="wb-contract" style="color:var(--accent-amber)">SAR 185M</div><div class="ws-label">Contract</div></div>
        </div>
      </div>

      <div class="page-actions" style="margin-bottom:16px">
        <button class="btn btn-pdf" onclick="printDashboardPDF()">ğŸ–¨ Print Dashboard PDF</button>
        <button class="btn btn-secondary" onclick="openAddProjectModal()">â• New Project</button>
      </div>

      <div class="kpi-grid">
        <div class="kpi-card blue"><div class="kpi-label">Drawings Pending</div><div class="kpi-value" id="kpi-drawings-pending">â€”</div><div class="kpi-sub">Awaiting approval</div><div class="kpi-icon">ğŸ“</div></div>
        <div class="kpi-card rose"><div class="kpi-label">Open NCR/RFI/SI</div><div class="kpi-value" id="kpi-open-ncrs">â€”</div><div class="kpi-sub">Requires action</div><div class="kpi-icon">âš ï¸</div></div>
        <div class="kpi-card amber"><div class="kpi-label">Schedule Variance</div><div class="kpi-value" id="kpi-schedule-var">â€”</div><div class="kpi-sub">vs. baseline</div><div class="kpi-icon">ğŸ“…</div></div>
        <div class="kpi-card rose"><div class="kpi-label">Cost Variance</div><div class="kpi-value" id="kpi-cost-var">â€”</div><div class="kpi-sub">vs. revised budget</div><div class="kpi-icon">ğŸ’°</div></div>
        <div class="kpi-card emerald"><div class="kpi-label">Overall Progress</div><div class="kpi-value" id="kpi-progress">â€”</div><div class="kpi-sub">Physical completion</div><div class="kpi-icon">ğŸ“Š</div></div>
        <div class="kpi-card cyan"><div class="kpi-label">Active Workers</div><div class="kpi-value" id="kpi-workers">â€”</div><div class="kpi-sub">On site today</div><div class="kpi-icon">ğŸ‘·</div></div>
        <div class="kpi-card violet"><div class="kpi-label">Safe Man Hours</div><div class="kpi-value" id="kpi-safe-hours">â€”</div><div class="kpi-sub">Total LTI-free</div><div class="kpi-icon">ğŸ¦º</div></div>
        <div class="kpi-card emerald"><div class="kpi-label">LTIR</div><div class="kpi-value" id="kpi-ltir">â€”</div><div class="kpi-sub">Lost Time Injury Rate</div><div class="kpi-icon">ğŸ“‹</div></div>
      </div>

      <div class="dashboard-grid">
        <div class="card"><div class="card-header"><span class="card-title">ğŸ“ˆ S-CURVE â€” Planned vs. Actual Progress</span><button class="btn btn-sm btn-secondary" onclick="navigateTo('progress')">Full View â†’</button></div><div class="card-body"><div class="chart-wrapper" style="height:240px"><canvas id="scurve-chart"></canvas></div></div></div>
        <div class="card"><div class="card-header"><span class="card-title">ğŸ Key Milestones</span></div><div class="card-body"><div class="milestone-list" id="milestone-list"></div></div></div>
      </div>

      <div class="chart-grid">
        <div class="card"><div class="card-header"><span class="card-title">ğŸ“Š Discipline Progress</span></div><div class="card-body"><div class="chart-wrapper" style="height:220px"><canvas id="discipline-chart"></canvas></div></div></div>
        <div class="card"><div class="card-header"><span class="card-title">ğŸ”” Recent Activity</span></div><div class="card-body"><div class="activity-list" id="activity-feed"></div></div></div>
        <div class="card"><div class="card-header"><span class="card-title">âš¡ Quick Actions</span></div><div class="card-body" style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <button class="btn btn-secondary" onclick="openAddDrawingModal()">â• Add Drawing</button>
          <button class="btn btn-secondary" onclick="openAddNCRModal()">âš ï¸ Raise NCR</button>
          <button class="btn btn-secondary" onclick="openAddHSEModal()">ğŸ¦º Log Incident</button>
          <button class="btn btn-secondary" onclick="openAddSubModal()">ğŸ¤ Add Subcontractor</button>
          <button class="btn btn-secondary" onclick="navigateTo('cost')">ğŸ’° Cost Report</button>
          <button class="btn btn-secondary" onclick="navigateTo('procurement')">ğŸ›’ PO Tracker</button>
        </div></div>
      </div>
    </section>

    <!-- â•â•â• PROJECTS PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="page-section" id="page-projects">
      <div class="page-header">
        <div><div class="page-title">ğŸ“ Project Management</div><div class="page-subtitle">All projects â€“ edit, delete, switch active</div></div>
        <div class="page-actions">
          <button class="btn btn-secondary" onclick="exportProjectsCSV()">ğŸ“¥ Export CSV</button>
          <button class="btn btn-pdf" onclick="printProjectsPDF()">ğŸ–¨ Print PDF</button>
          <button class="btn btn-primary" onclick="openAddProjectModal()">â• New Project</button>
        </div>
      </div>
      <div class="filter-bar">
        <div class="filter-search"><span class="si">ğŸ”</span><input type="text" id="projects-filter-input" placeholder="Search projectsâ€¦"></div>
      </div>
      <div class="card">
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>ID</th><th>Code</th><th>Name</th><th>Client</th><th>Contract Value</th><th>Progress</th><th>Status</th><th>Actions</th>
              </tr>
            </thead>
            <tbody id="projects-table-body">
              <tr><td colspan="8" style="text-align:center;padding:32px"><div class="spinner"></div></td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- â•â•â• DRAWINGS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="page-section" id="page-drawings">
      <div class="page-header">
        <div><div class="page-title">ğŸ“ Drawing Register</div><div class="page-subtitle">MEP Split: Mechanical | Electrical | Plumbing | HVAC â€” Rev 1, Rev 2 format</div></div>
        <div class="page-actions">
          <button class="btn btn-secondary" onclick="triggerImport('drawings')">ğŸ“‚ Import CSV</button>
          <button class="btn btn-secondary" onclick="exportCurrentModule('drawings')">ğŸ“¥ Export CSV</button>
          <button class="btn btn-pdf" onclick="printDrawingsPDF()">ğŸ–¨ Print PDF</button>
          <button class="btn btn-primary" onclick="openAddDrawingModal()">â• Add Drawing</button>
        </div>
      </div>
      <div class="kpi-grid" id="drawings-stats" style="grid-template-columns:repeat(4,1fr)"></div>
      <!-- MEP Discipline Tabs -->
      <div class="mep-tabs">
        <button class="mep-tab active" data-mep="all">All Disciplines</button>
        <button class="mep-tab" data-mep="mep">All MEP</button>
        <button class="mep-tab" data-mep="mechanical">Mechanical</button>
        <button class="mep-tab" data-mep="electrical">Electrical</button>
        <button class="mep-tab" data-mep="plumbing">Plumbing</button>
        <button class="mep-tab" data-mep="hvac">HVAC</button>
        <button class="mep-tab" data-mep="firefighting">Firefighting</button>
        <button class="mep-tab" data-mep="architect">Architect</button>
        <button class="mep-tab" data-mep="civil">Civil</button>
        <button class="mep-tab" data-mep="structure">Structure</button>
      </div>
      <div class="filter-bar">
        <div class="filter-search"><span class="si">ğŸ”</span><input type="text" id="drawing-filter-input" placeholder="Search drawingsâ€¦"></div>
        <select class="filter-select" id="drawing-status-filter">
          <option value="">All Status</option><option value="approved">Approved</option><option value="under-review">Under Review</option><option value="submitted">Submitted</option><option value="rejected">Rejected</option>
        </select>
      </div>
      <div class="card"><div class="table-container"><table>
        <thead><tr><th>DWG ID</th><th>Title</th><th>Discipline</th><th>Rev</th><th>Status</th><th>Date</th><th>Comments</th><th>Actions</th></tr></thead>
        <tbody id="drawings-table-body"></tbody>
      </table></div></div>
      <div style="margin-top:8px;font-family:'DM Mono',monospace;font-size:10px;color:var(--text-muted)">ğŸ“‚ Local file path configured in data.js</div>
    </section>

    <!-- â•â•â• MATERIALS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="page-section" id="page-materials">
      <div class="page-header">
        <div><div class="page-title">ğŸ§± Material Submittal Register</div><div class="page-subtitle">BOQ-linked approvals | PO References | Rev 1, Rev 2 format</div></div>
        <div class="page-actions">
          <button class="btn btn-secondary" onclick="triggerImport('materials')">ğŸ“‚ Import CSV</button>
          <button class="btn btn-secondary" onclick="exportCurrentModule('materials')">ğŸ“¥ Export CSV</button>
          <button class="btn btn-pdf" onclick="printMaterialsPDF()">ğŸ–¨ Print PDF</button>
          <button class="btn btn-primary" onclick="openAddMaterialModal()">â• New Submittal</button>
        </div>
      </div>
      <div class="kpi-grid" id="materials-stats" style="grid-template-columns:repeat(4,1fr)"></div>
      <div class="filter-bar"><div class="filter-search"><span class="si">ğŸ”</span><input type="text" id="material-filter-input" placeholder="Search materialsâ€¦"></div></div>
      <div class="card"><div class="table-container"><table>
        <thead><tr><th>ID</th><th>Material Description</th><th>BOQ Ref</th><th>PO No.</th><th>Supplier</th><th>Rev</th><th>Status</th><th>Submitted</th><th>Approved</th><th>Delivery</th><th>Remarks</th><th>Actions</th></tr></thead>
        <tbody id="materials-table-body"></tbody>
      </table></div></div>
    </section>

    <!-- â•â•â• METHODS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="page-section" id="page-methods">
      <div class="page-header">
        <div><div class="page-title">ğŸ“‹ Method Statement Register</div><div class="page-subtitle">Construction methods, HSE reviews â€” Rev 1, Rev 2 format</div></div>
        <div class="page-actions">
          <button class="btn btn-secondary" onclick="exportCurrentModule('methods')">ğŸ“¥ Export CSV</button>
          <button class="btn btn-pdf" onclick="printMethodsPDF()">ğŸ–¨ Print PDF</button>
          <button class="btn btn-primary" onclick="openAddMethodModal()">â• New MS</button>
        </div>
      </div>
      <div class="kpi-grid" id="methods-stats" style="grid-template-columns:repeat(4,1fr)"></div>
      <div class="filter-bar"><div class="filter-search"><span class="si">ğŸ”</span><input type="text" id="method-filter-input" placeholder="Search method statementsâ€¦"></div></div>
      <div class="card"><div class="table-container"><table>
        <thead><tr><th>MS ID</th><th>Title</th><th>Category</th><th>Risk Level</th><th>Rev</th><th>Status</th><th>HSE Review</th><th>Date</th><th>Actions</th></tr></thead>
        <tbody id="methods-table-body"></tbody>
      </table></div></div>
    </section>

    <!-- â•â•â• TESTING â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="page-section" id="page-testing">
      <div class="page-header">
        <div><div class="page-title">ğŸ”¬ Test &amp; Commissioning Register</div><div class="page-subtitle">Test certificates, commissioning logs â€” Rev 1, Rev 2 format</div></div>
        <div class="page-actions">
          <button class="btn btn-secondary" onclick="exportCurrentModule('testing')">ğŸ“¥ Export CSV</button>
          <button class="btn btn-pdf" onclick="printTestingPDF()">ğŸ–¨ Print PDF</button>
          <button class="btn btn-primary" onclick="openAddTestModal()">â• Add Test Record</button>
        </div>
      </div>
      <div class="kpi-grid" id="testing-stats" style="grid-template-columns:repeat(4,1fr)"></div>
      <div class="card"><div class="table-container"><table>
        <thead><tr><th>ID</th><th>System / Test</th><th>Type</th><th>Date</th><th>Rev</th><th>Status</th><th>Certificate</th><th>Remarks</th><th>Actions</th></tr></thead>
        <tbody id="testing-table-body"></tbody>
      </table></div></div>
    </section>

    <!-- â•â•â• NCR / RFI / SI â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="page-section" id="page-ncr">
      <div class="page-header">
        <div><div class="page-title">âš ï¸ NCR / RFI / Site Instructions</div><div class="page-subtitle">Three separate registers â€” local drive file links enabled</div></div>
        <div class="page-actions" id="ncr-page-actions">
          <!-- dynamically updated -->
        </div>
      </div>
      <div class="register-tabs">
        <button class="register-tab ncr-tab active" data-ncrtab="ncr" onclick="setNCRTab('ncr');updateNCRActions('ncr')">âš ï¸ Non-Conformance (NCR)</button>
        <button class="register-tab ncr-tab" data-ncrtab="rfi" onclick="setNCRTab('rfi');updateNCRActions('rfi')">â“ Requests for Info (RFI)</button>
        <button class="register-tab ncr-tab" data-ncrtab="si" onclick="setNCRTab('si');updateNCRActions('si')">ğŸ“‹ Site Instructions (SI)</button>
      </div>
      <!-- NCR SECTION -->
      <div class="ncr-sub-section" id="ncr-section-ncr">
        <div class="kpi-grid" id="ncr-stats" style="grid-template-columns:repeat(4,1fr)"></div>
        <div class="filter-bar"><div class="filter-search"><span class="si">ğŸ”</span><input type="text" id="ncr-filter-input" placeholder="Search NCRsâ€¦"></div></div>
        <div class="card"><div class="table-container"><table>
          <thead><tr><th>NCR ID</th><th>Title</th><th>Priority</th><th>Status</th><th>Date Raised</th><th>Closure Date</th><th>Location</th><th>Remarks</th><th>Actions</th></tr></thead>
          <tbody id="ncr-table-body"></tbody>
        </table></div></div>
      </div>
      <!-- RFI SECTION -->
      <div class="ncr-sub-section" id="ncr-section-rfi" style="display:none">
        <div class="card"><div class="table-container"><table>
          <thead><tr><th>RFI ID</th><th>Title</th><th>Discipline</th><th>Priority</th><th>Status</th><th>Date</th><th>Closure Date</th><th>Remarks</th><th>Actions</th></tr></thead>
          <tbody id="rfi-table-body"></tbody>
        </table></div></div>
      </div>
      <!-- SI SECTION -->
      <div class="ncr-sub-section" id="ncr-section-si" style="display:none">
        <div class="card"><div class="table-container"><table>
          <thead><tr><th>SI ID</th><th>Title</th><th>Ref / SKT</th><th>Priority</th><th>Status</th><th>Date</th><th>Cost Impact</th><th>Remarks</th><th>Actions</th></tr></thead>
          <tbody id="si-table-body"></tbody>
        </table></div></div>
      </div>
    </section>

    <!-- â•â•â• PROCUREMENT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="page-section" id="page-procurement">
      <div class="page-header">
        <div><div class="page-title">ğŸ›’ Procurement Tracker</div><div class="page-subtitle">Purchase orders, deliveries, vendor performance</div></div>
        <div class="page-actions">
          <button class="btn btn-secondary" onclick="exportCurrentModule('procurement')">ğŸ“¥ Export CSV</button>
          <button class="btn btn-pdf" onclick="printProcurementPDF()">ğŸ–¨ Print PDF</button>
          <button class="btn btn-primary" onclick="openAddPOModal()">â• New PO</button>
        </div>
      </div>
      <div class="kpi-grid" id="procurement-stats" style="grid-template-columns:repeat(4,1fr)"></div>
      <div class="chart-grid" style="margin-bottom:20px">
        <div class="card"><div class="card-header"><span class="card-title">PO Value Distribution</span></div><div class="card-body"><div class="chart-wrapper" style="height:200px"><canvas id="procurement-chart"></canvas></div></div></div>
      </div>
      <div class="filter-bar"><div class="filter-search"><span class="si">ğŸ”</span><input type="text" id="procurement-filter-input" placeholder="Search procurementâ€¦"></div></div>
      <div class="card"><div class="table-container"><table>
        <thead><tr><th>PO No.</th><th>Description</th><th>Vendor</th><th>PO Value</th><th>Status</th><th>Delivery Date</th><th>Payment</th><th>Performance</th><th>Remarks</th><th>Actions</th></tr></thead>
        <tbody id="procurement-table-body"></tbody>
      </table></div></div>
    </section>

    <!-- â•â•â• PROGRESS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="page-section" id="page-progress">
      <div class="page-header">
        <div><div class="page-title">ğŸ“ˆ Progress Tracker</div><div class="page-subtitle">S-Curve, milestone tracking, discipline progress</div></div>
        <div class="page-actions">
          <button class="btn btn-pdf" onclick="printProgressPDF()">ğŸ–¨ Print Weekly Report PDF</button>
          <button class="btn btn-primary" onclick="openUpdateProgressModal()">â• Update Progress</button>
        </div>
      </div>
      <div class="kpi-grid" id="progress-stats" style="grid-template-columns:repeat(4,1fr)"></div>
      <div class="card" style="margin-bottom:16px"><div class="card-header"><span class="card-title">ğŸ“ˆ S-Curve â€” Planned vs. Actual</span></div><div class="card-body"><div class="chart-wrapper" style="height:280px"><canvas id="progress-scurve-chart"></canvas></div></div></div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
        <div class="card"><div class="card-header"><span class="card-title">Milestone Tracker</span></div><div class="card-body"><div class="milestone-list" id="milestone-list"></div></div></div>
        <div class="card"><div class="card-header"><span class="card-title">Discipline Progress</span></div><div class="card-body"><div id="discipline-progress-list"></div></div></div>
      </div>
    </section>

    <!-- â•â•â• HSE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="page-section" id="page-hse">
      <div class="page-header">
        <div><div class="page-title">ğŸ¦º HSE Register</div><div class="page-subtitle">Incidents, near-misses, corrective actions, safety statistics</div></div>
        <div class="page-actions">
          <button class="btn btn-secondary" onclick="exportCurrentModule('hse')">ğŸ“¥ Export CSV</button>
          <button class="btn btn-pdf" onclick="printHSEPDF()">ğŸ–¨ Print PDF</button>
          <button class="btn btn-warning" onclick="openAddHSEModal()">ğŸš¨ Log Incident</button>
        </div>
      </div>
      <div class="kpi-grid" id="hse-stats" style="grid-template-columns:repeat(4,1fr)"></div>
      <div class="chart-grid" style="margin-bottom:20px">
        <div class="card"><div class="card-header"><span class="card-title">Incident Type Breakdown</span></div><div class="card-body"><div class="chart-wrapper" style="height:200px"><canvas id="hse-chart"></canvas></div></div></div>
        <div class="card"><div class="card-header"><span class="card-title">HSE Performance</span></div><div class="card-body"><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
          <div style="text-align:center;padding:12px;background:var(--bg-surface);border-radius:8px"><div style="font-family:'Barlow Condensed',sans-serif;font-size:36px;font-weight:800;color:var(--accent-emerald)">284K</div><div style="font-size:10px;color:var(--text-muted);text-transform:uppercase">Safe Man Hours</div></div>
          <div style="text-align:center;padding:12px;background:var(--bg-surface);border-radius:8px"><div style="font-family:'Barlow Condensed',sans-serif;font-size:36px;font-weight:800;color:var(--accent-amber)">0.35</div><div style="font-size:10px;color:var(--text-muted);text-transform:uppercase">LTIR Score</div></div>
          <div style="text-align:center;padding:12px;background:var(--bg-surface);border-radius:8px"><div style="font-family:'Barlow Condensed',sans-serif;font-size:36px;font-weight:800;color:var(--accent-blue)">48</div><div style="font-size:10px;color:var(--text-muted);text-transform:uppercase">Toolbox Talks</div></div>
          <div style="text-align:center;padding:12px;background:var(--bg-surface);border-radius:8px"><div style="font-family:'Barlow Condensed',sans-serif;font-size:36px;font-weight:800;color:var(--accent-rose)">1</div><div style="font-size:10px;color:var(--text-muted);text-transform:uppercase">LTIs Recorded</div></div>
        </div></div></div>
      </div>
      <div class="card"><div class="table-container"><table>
        <thead><tr><th>ID</th><th>Type</th><th>Description</th><th>Date</th><th>Severity</th><th>Status</th><th>Casualties</th><th>Location</th><th>Corrective Action</th><th>Actions</th></tr></thead>
        <tbody id="hse-table-body"></tbody>
      </table></div></div>
    </section>

    <!-- â•â•â• SUBCONTRACTORS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="page-section" id="page-subcontractors">
      <div class="page-header">
        <div><div class="page-title">ğŸ¤ Subcontractor Management</div><div class="page-subtitle">Attendance, payments, performance â€” PO references included</div></div>
        <div class="page-actions">
          <button class="btn btn-secondary" onclick="exportCurrentModule('subcontractors')">ğŸ“¥ Export CSV</button>
          <button class="btn btn-pdf" onclick="printSubPDF()">ğŸ–¨ Print PDF</button>
          <button class="btn btn-primary" onclick="openAddSubModal()">â• Add Subcontractor</button>
        </div>
      </div>
      <div class="kpi-grid" id="sub-stats" style="grid-template-columns:repeat(4,1fr)"></div>
      <div class="card"><div class="table-container"><table>
        <thead><tr><th>ID</th><th>Company</th><th>Scope</th><th>PO Ref</th><th>Status</th><th>Workers</th><th>Contract Value</th><th>Paid to Date</th><th>Performance</th><th>Actions</th></tr></thead>
        <tbody id="sub-table-body"></tbody>
      </table></div></div>
    </section>

    <!-- â•â•â• COST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="page-section" id="page-cost">
      <div class="page-header">
        <div><div class="page-title">ğŸ’° Cost Control</div><div class="page-subtitle">Budget vs. actual, committed cost, forecast-to-complete</div></div>
        <div class="page-actions">
          <button class="btn btn-secondary" onclick="exportCurrentModule('cost')">ğŸ“¥ Export CSV</button>
          <button class="btn btn-pdf" onclick="printCostPDF()">ğŸ–¨ Print PDF</button>
          <button class="btn btn-primary" onclick="showToast('Variation','Opening variation order form','info')">ğŸ“ Variation Order</button>
        </div>
      </div>
      <div class="kpi-grid" id="cost-stats" style="grid-template-columns:repeat(4,1fr)"></div>
      <div class="card" style="margin-bottom:16px"><div class="card-header"><span class="card-title">Budget vs. Forecast vs. Actual</span></div><div class="card-body"><div class="chart-wrapper" style="height:260px"><canvas id="cost-chart"></canvas></div></div></div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px">
        <div class="card" style="background:rgba(59,130,246,0.06);border-color:rgba(59,130,246,0.15)"><div class="card-body" style="text-align:center"><div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--accent-blue);margin-bottom:4px;text-transform:uppercase">Revised Budget</div><div style="font-family:'Barlow Condensed',sans-serif;font-size:26px;font-weight:800;color:var(--accent-blue)">SAR 188.2M</div></div></div>
        <div class="card" style="background:rgba(16,185,129,0.06);border-color:rgba(16,185,129,0.15)"><div class="card-body" style="text-align:center"><div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--accent-emerald);margin-bottom:4px;text-transform:uppercase">Actual Cost to Date</div><div style="font-family:'Barlow Condensed',sans-serif;font-size:26px;font-weight:800;color:var(--accent-emerald)">SAR 67.2M</div></div></div>
        <div class="card" style="background:rgba(244,63,94,0.06);border-color:rgba(244,63,94,0.15)"><div class="card-body" style="text-align:center"><div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--accent-rose);margin-bottom:4px;text-transform:uppercase">Forecast Final Cost</div><div style="font-family:'Barlow Condensed',sans-serif;font-size:26px;font-weight:800;color:var(--accent-rose)">SAR 192.5M <span style="font-size:11px">â–² 4.3M</span></div></div></div>
      </div>
      <div class="card"><div class="table-container"><table>
        <thead><tr><th>Category</th><th>Budget</th><th>Committed</th><th>Actual</th><th>Forecast</th><th>Variance</th><th>% Spent</th><th>Actions</th></tr></thead>
        <tbody id="cost-table-body"></tbody>
      </table></div></div>
    </section>

    <!-- â•â•â• MANPOWER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="page-section" id="page-manpower">
      <div class="page-header">
        <div><div class="page-title">ğŸ‘· Manpower &amp; Equipment</div><div class="page-subtitle">Daily worker logs, equipment utilization, weekly targets</div></div>
        <div class="page-actions">
          <button class="btn btn-secondary" onclick="exportCurrentModule('manpower')">ğŸ“¥ Export CSV</button>
          <button class="btn btn-pdf" onclick="printManpowerPDF()">ğŸ–¨ Print PDF</button>
          <button class="btn btn-primary" onclick="openAddDailyLogModal()">â• Daily Log Entry</button>
        </div>
      </div>
      <div class="kpi-grid" id="manpower-stats" style="grid-template-columns:repeat(4,1fr)"></div>
      <div style="display:grid;grid-template-columns:2fr 1fr;gap:16px;margin-bottom:16px">
        <div class="card"><div class="card-header"><span class="card-title">Weekly Manpower â€” Target vs. Actual</span></div><div class="card-body"><div class="chart-wrapper" style="height:220px"><canvas id="manpower-chart"></canvas></div></div></div>
        <div class="card"><div class="card-header"><span class="card-title">Equipment Utilization</span></div><div class="card-body"><div class="equip-list" id="equipment-list"></div></div></div>
      </div>
      <div class="card"><div class="card-header"><span class="card-title">Weekly Manpower Log</span></div><div class="table-container"><table>
        <thead><tr><th>Week</th><th>Target</th><th>Actual</th><th>Skilled</th><th>Unskilled</th><th>Staff</th><th>Progress</th><th>Achievement</th><th>Actions</th></tr></thead>
        <tbody id="manpower-table-body"></tbody>
      </table></div></div>
    </section>

    <!-- â•â•â• CLOSEOUT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="page-section" id="page-closeout">
      <div class="page-header">
        <div><div class="page-title">ğŸ Project Closeout</div><div class="page-subtitle">Handover docs, as-built drawings, O&amp;M manuals, occupancy permits</div></div>
        <div class="page-actions">
          <button class="btn btn-secondary" onclick="exportCurrentModule('closeout')">ğŸ“¥ Export CSV</button>
          <button class="btn btn-pdf" onclick="printCloseoutPDF()">ğŸ–¨ Print PDF</button>
          <button class="btn btn-primary" onclick="openAddCloseoutItemModal()">â• Add Item</button>
        </div>
      </div>
      <div class="kpi-grid" id="closeout-stats" style="grid-template-columns:repeat(4,1fr)"></div>
      <div class="card"><div class="table-container"><table>
        <thead><tr><th>ID</th><th>Closeout Item</th><th>Category</th><th>Status</th><th>Due Date</th><th>Assigned To</th><th>Remarks</th><th>Actions</th></tr></thead>
        <tbody id="closeout-table-body"></tbody>
      </table></div></div>
    </section>

  </main>
</div>

<!-- â”€â”€ NOTIFICATION PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="notif-panel" id="notif-panel">
  <div class="notif-header">
    <span style="font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:16px">Notifications</span>
    <button class="btn btn-sm btn-secondary" onclick="document.getElementById('notif-panel').classList.remove('open')">âœ•</button>
  </div>
  <div id="notif-list"></div>
</div>

<!-- â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="modal-title">Modal</div>
      <button class="modal-close" onclick="closeModal()">âœ•</button>
    </div>
    <div class="modal-body" id="modal-body"></div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" id="modal-save-btn" style="display:none">Save</button>
    </div>
  </div>
</div>

<!-- â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="toast-container" id="toast-container"></div>

<!-- â”€â”€ SCRIPTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<script src="images.js"></script>
<script src="data.js"></script>
<script src="app.js"></script>

<script>
  // Set logo in sidebar once images.js loads
  window.addEventListener('load', () => {
    if (window.LOGO_B64) {
      document.getElementById('sidebar-logo').src = window.LOGO_B64;
    }
  });

  // NCR action buttons update on tab switch
  function updateNCRActions(tab) {
    const actions = document.getElementById('ncr-page-actions');
    const labels = { ncr:'NCR', rfi:'RFI', si:'SI' };
    const printFns = { ncr:'printNCRPDF', rfi:'printRFIPDF', si:'printSIPDF' };
    const exportKeys = { ncr:'ncr', rfi:'rfi', si:'si' };
    actions.innerHTML = `
      <button class="btn btn-secondary" onclick="exportCurrentModule('${exportKeys[tab]}')">ğŸ“¥ Export ${labels[tab]} CSV</button>
      <button class="btn btn-pdf" onclick="${printFns[tab]}()">ğŸ–¨ Print ${labels[tab]} PDF</button>
      <button class="btn btn-danger" onclick="openAddNCRModal()">ğŸš¨ Raise ${labels[tab]}</button>`;
  }
  updateNCRActions('ncr');

  // Keyboard shortcut removed because top search bar is gone
  // document.addEventListener('keydown', e => { ... }); // removed
</script>

</body>
</html>
